# Generated by Struktur (Nunjucks)
# Build time: {{ $metadata.timestamp }}

{% for instance in $instances %}
{% if instance.class == "web_service" %}
# {{ instance.name }} - {{ instance.description }}
server {
    listen {{ instance.$aspects.web_service.port }};
    server_name {{ instance.$aspects.web_service.hostname }};

{% if instance.$aspects.web_service.ssl_enabled %}
    # SSL Configuration
    ssl_certificate {{ instance.$aspects.web_service.ssl_cert }};
    ssl_certificate_key {{ instance.$aspects.web_service.ssl_key }};
    ssl_protocols TLSv1.2 TLSv1.3;
{% endif %}

    location / {
        proxy_pass {{ instance.$aspects.web_service.protocol }}://{{ instance.$aspects.web_service.hostname }}:{{ instance.$aspects.web_service.port }};
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

{% endif %}
{% endfor %}
