# Generated by Struktur (Handlebars)
# Build time: {{$metadata.timestamp}}

version: '3.8'

services:
{{#each (where $instances "$class" "web_service")}}
  {{$id}}:
    image: nginx:alpine
    container_name: {{$id}}
    ports:
      - "{{$aspects.aspect_web_service.port}}:{{$aspects.aspect_web_service.port}}"
    environment:
      - SERVICE_NAME={{{name}}}
      - WORKERS={{{$aspects.aspect_web_service.workers}}}
{{#if $aspects.aspect_web_service.ssl_enabled}}
      - SSL_ENABLED=true
    volumes:
      - {{$aspects.aspect_web_service.ssl_cert}}:{{$aspects.aspect_web_service.ssl_cert}}:ro
      - {{$aspects.aspect_web_service.ssl_key}}:{{$aspects.aspect_web_service.ssl_key}}:ro
{{else}}
      - SSL_ENABLED=false
{{/if}}
    networks:
      - {{lowercase (replace name " " "-")}}-network
    restart: unless-stopped

{{/each}}
networks:
{{#each (where $instances "$class" "web_service")}}
  {{lowercase (replace name " " "-")}}-network:
    driver: bridge
{{/each}}
